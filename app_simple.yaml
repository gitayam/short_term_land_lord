service: short-term-landlord
runtime: python311

env_variables:
  FLASK_ENV: "appengine"
  
  # Improved persistence: Use Cloud Storage mounted volume for SQLite
  # This provides better persistence than /tmp
  DATABASE_URL: "sqlite:////opt/app/data/landlord.db" 
  GOOGLE_CLOUD_PROJECT_ID: "speech-memorization"
  
  # Enable automatic database backup to Cloud Storage
  DATABASE_BACKUP_ENABLED: "true"
  BACKUP_BUCKET: "speech-memorization-backups"
  
  # Note: /opt/app/data persists longer but for true persistence, use Cloud SQL
  
  # Disable features that require external services for initial deployment
  NOTIFICATION_EMAIL_ENABLED: "false"
  NOTIFICATION_SMS_ENABLED: "false"
  CACHE_TYPE: "simple"
  SESSION_TYPE: "simple"
  RATELIMIT_ENABLED: "false"
  
  # App Engine specific settings
  HEALTH_CHECK_ENABLED: "true"
  PROMETHEUS_METRICS: "false"
  
  # Admin username (non-sensitive)
  ADMIN_USERNAME: "admin"
  
  # Secret Manager paths (application will fetch these)
  SECRET_KEY_PATH: "projects/speech-memorization/secrets/SECRET_KEY/versions/latest"
  ADMIN_EMAIL_PATH: "projects/speech-memorization/secrets/ADMIN_EMAIL/versions/latest"
  ADMIN_PASSWORD_PATH: "projects/speech-memorization/secrets/ADMIN_PASSWORD/versions/latest"

entrypoint: gunicorn main:app --bind :$PORT

automatic_scaling:
  min_instances: 0
  max_instances: 5

handlers:
- url: /.*
  script: auto
  secure: always