service: short-term-landlord
runtime: python311

env_variables:
  FLASK_ENV: production
  SECRET_KEY: "ys-UAwX9cpR15q61xQMvDsv03KUvigYnLyv5rkOQZsg"
  DATABASE_URL: "sqlite:///landlord_app.db"
  GOOGLE_CLOUD_PROJECT_ID: "speech-memorization"
  REDIS_URL: "redis://localhost:6379/1"
  
  # Security settings
  WTF_CSRF_TIME_LIMIT: "3600"
  PERMANENT_SESSION_LIFETIME: "1800"
  
  # Performance settings
  CACHE_TYPE: "simple"
  SESSION_TYPE: "filesystem"
  SQLALCHEMY_RECORD_QUERIES: "true"
  DATABASE_QUERY_TIMEOUT: "30"
  SLOW_QUERY_THRESHOLD: "0.5"
  
  # File uploads
  MAX_CONTENT_LENGTH: "16777216"  # 16MB
  MEDIA_STORAGE_BACKEND: "local"
  GCS_BUCKET: "speech-memorization-landlord-media"
  
  # Email configuration
  MAIL_SERVER: "smtp.sendgrid.net"
  MAIL_PORT: "587"
  MAIL_USE_TLS: "true"
  MAIL_USERNAME: "apikey"
  MAIL_PASSWORD: "your-sendgrid-api-key"
  MAIL_DEFAULT_SENDER: "noreply@landlord-app.com"
  
  # Monitoring
  SENTRY_DSN: ""
  PROMETHEUS_METRICS: "true"
  HEALTH_CHECK_ENABLED: "true"
  
  # Rate limiting
  RATELIMIT_ENABLED: "true"
  RATELIMIT_STRATEGY: "fixed-window"

automatic_scaling:
  min_instances: 0
  max_instances: 15
  target_cpu_utilization: 0.7
  target_throughput_utilization: 0.8

resources:
  cpu: 1
  memory_gb: 2
  disk_size_gb: 10

handlers:
# Static files for landlord app
- url: /static
  static_dir: app/static
  secure: always
  expiration: "7d"
  http_headers:
    Cache-Control: "public, max-age=604800"

# Media files for property images
- url: /media
  static_dir: app/static/uploads
  secure: always
  expiration: "1d"

# Favicon
- url: /favicon.ico
  static_files: app/static/favicon.ico
  upload: app/static/favicon.ico
  secure: always

# Health check endpoint
- url: /health
  script: auto
  secure: always

# All other URLs go to Flask
- url: /.*
  script: auto
  secure: always

# Use gunicorn as the WSGI server
entrypoint: gunicorn main_landlord:app --bind :$PORT --workers 3 --timeout 120 --preload