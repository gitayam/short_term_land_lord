{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="app-card">
                <div class="app-card-header text-center">
                    <i class="bi bi-box-arrow-in-right fs-1 text-primary mb-3"></i>
                    <h1 class="h3 mb-0">Welcome Back</h1>
                    <p class="text-secondary mb-0">Sign in to your account</p>
                </div>
                <div class="app-card-body">
                    {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                        <div class="app-alert app-alert-{% if category == 'error' %}danger{% else %}{{ category }}{% endif %}">
                            <i class="bi bi-{% if category == 'error' %}exclamation-triangle{% elif category == 'success' %}check-circle{% else %}info-circle{% endif %}"></i>
                            <div>{{ message }}</div>
                        </div>
                        {% endfor %}
                    {% endif %}
                    {% endwith %}
                    
                    {% if use_local and local_form %}
                    <form method="POST" action="{{ url_for('auth.login') }}" class="app-form" id="loginForm">
                        {{ local_form.hidden_tag() }}
                        
                        <div class="app-form-group">
                            {{ local_form.email.label(class="app-form-label") }}
                            <div class="app-form-input-wrapper">
                                <i class="bi bi-envelope-at app-form-icon"></i>
                                {{ local_form.email(class="app-form-input", placeholder="Enter your email address") }}
                            </div>
                            {% for error in local_form.email.errors %}
                            <div class="app-form-error">{{ error }}</div>
                            {% endfor %}
                        </div>
                        
                        <div class="app-form-group">
                            {{ local_form.password.label(class="app-form-label") }}
                            <div class="app-form-input-wrapper">
                                <i class="bi bi-key app-form-icon"></i>
                                {{ local_form.password(class="app-form-input", placeholder="Enter your password") }}
                                <button type="button" class="app-form-toggle-password" aria-label="Toggle password visibility">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            {% for error in local_form.password.errors %}
                            <div class="app-form-error">{{ error }}</div>
                            {% endfor %}
                        </div>
                        
                        <div class="app-form-group">
                            <label class="app-form-checkbox">
                                {{ local_form.remember_me(class="app-form-checkbox-input") }}
                                <span class="app-form-checkbox-label">{{ local_form.remember_me.label.text }}</span>
                                <span class="app-form-checkbox-checkmark"></span>
                            </label>
                        </div>
                        
                        <div class="app-form-group">
                            <button type="submit" class="app-btn app-btn-primary app-btn-lg w-100" id="loginSubmit">
                                <span class="btn-text">{{ local_form.submit.label.text }}</span>
                                <span class="btn-loading d-none">
                                    <i class="bi bi-arrow-clockwise spin"></i>
                                    Signing in...
                                </span>
                            </button>
                        </div>
                        
                        {% if config.get('ENABLE_PASSWORD_RESET', False) %}
                        <div class="text-center mt-3">
                            <a href="{{ url_for('auth.reset_password_request') }}" class="app-link">
                                <i class="bi bi-arrow-clockwise me-1"></i>
                                Forgot your password?
                            </a>
                        </div>
                        {% endif %}
                    </form>
                    {% endif %}
                    
                    {% if use_sso and sso_form %}
                    <div class="mt-4">
                        <div class="app-divider">
                            <span class="app-divider-text">OR</span>
                        </div>
                        <form method="POST" action="{{ url_for('auth.login') }}">
                            {{ sso_form.hidden_tag() }}
                            <button type="submit" class="app-btn app-btn-secondary app-btn-lg w-100">
                                <i class="bi bi-shield-lock me-2"></i>
                                {{ sso_form.submit.label.text }}
                            </button>
                        </form>
                    </div>
                    {% endif %}
                </div>
                <div class="app-card-footer text-center">
                    <p class="mb-0 text-secondary">
                        Don't have an account? 
                        <a href="{{ url_for('auth.register') }}" class="app-link app-link-primary">
                            <i class="bi bi-person-plus me-1"></i>
                            Register
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Password visibility toggle
    const passwordToggle = document.querySelector('.app-form-toggle-password');
    const passwordInput = document.querySelector('#password');
    
    if (passwordToggle && passwordInput) {
        passwordToggle.addEventListener('click', function() {
            const isPassword = passwordInput.type === 'password';
            passwordInput.type = isPassword ? 'text' : 'password';
            const icon = this.querySelector('i');
            icon.className = isPassword ? 'bi bi-eye-slash' : 'bi bi-eye';
            this.setAttribute('aria-label', isPassword ? 'Hide password' : 'Show password');
        });
    }
    
    // Form submission with loading state
    const loginForm = document.getElementById('loginForm');
    const submitBtn = document.getElementById('loginSubmit');
    
    if (loginForm && submitBtn) {
        loginForm.addEventListener('submit', function() {
            const btnText = submitBtn.querySelector('.btn-text');
            const btnLoading = submitBtn.querySelector('.btn-loading');
            
            submitBtn.disabled = true;
            btnText.classList.add('d-none');
            btnLoading.classList.remove('d-none');
        });
    }
    
    // Auto-focus first input
    const emailInput = document.querySelector('#email');
    if (emailInput && !emailInput.value) {
        emailInput.focus();
    }
});
</script>

<style>
.app-form-toggle-password {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--app-text-secondary);
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: color 0.2s ease;
}

.app-form-toggle-password:hover {
    color: var(--app-text-primary);
    background-color: var(--app-surface-hover);
}

.app-form-input-wrapper {
    position: relative;
}

.app-form-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--app-text-secondary);
    pointer-events: none;
}

.app-form-input {
    padding-left: 40px !important;
    padding-right: 44px !important;
}

.app-divider {
    position: relative;
    text-align: center;
    margin: 1.5rem 0;
}

.app-divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: var(--app-border-color);
}

.app-divider-text {
    background: var(--app-surface);
    padding: 0 1rem;
    color: var(--app-text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
}

.spin {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

{% endblock %} 